#include "clock.h"
#include <stdbool.h>
#include <string.h>
// 
//  Font data for Microsoft Sans Serif 10pt
// 

// Character bitmaps for Microsoft Sans Serif 10pt
const uint8_t microsoftSansSerif_10ptBitmaps[] = 
{
//1           
	0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
//5
        0x00, 0x00, 0x00, 0x00, 0xF8, 0x88, 0x88, 0x88, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x09, 0x10, 0x10, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 
//:
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
//0
	0x00, 0x00, 0x00, 0x00, 0xF0, 0x08, 0x08, 0x08, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x0F, 0x10, 0x10, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 
//2
	0x00, 0x00, 0x00, 0x00, 0x30, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1C, 0x12, 0x11, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 
//:
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
//2
	0x00, 0x00, 0x00, 0x00, 0x30, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1C, 0x12, 0x11, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 
//7 
	0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x08, 0xC8, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 

};
const uint8_t digit_0[] =
{
	// @0 '0' (14 pixels wide)
	//               
	//               
	//               
	//      ###      
	//     #   #     
	//     #   #     
	//     #   #     
	//     #   #     
	//     #   #     
	//     #   #     
	//     #   #     
	//     #   #     
	//      ###      
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0xF0, 0x08, 0x08, 0x08, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x0F, 0x10, 0x10, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_1[] =
{
	// @28 '1' (14 pixels wide)
	//               
	//               
	//               
	//       #       
	//     ###       
	//       #       
	//       #       
	//       #       
	//       #       
	//       #       
	//       #       
	//       #       
	//       #       
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_2[] =
{
	// @56 '2' (14 pixels wide)
	//               
	//               
	//               
	//      ###      
	//     #   #     
	//     #   #     
	//         #     
	//        #      
	//       #       
	//      #        
	//     #         
	//     #         
	//     #####     
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0x30, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1C, 0x12, 0x11, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_3[] =
{
	// @84 '3' (14 pixels wide)
	//               
	//               
	//               
	//      ###      
	//     #   #     
	//         #     
	//         #     
	//       ##      
	//         #     
	//         #     
	//         #     
	//     #   #     
	//      ###      
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0x10, 0x08, 0x88, 0x88, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x08, 0x10, 0x10, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_4[] =
{
	//               
	//               
	//         #     
	//        ##     
	//       # #     
	//       # #     
	//      #  #     
	//     #   #     
	//     #####     
	//         #     
	//         #     
	//         #     
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x03, 0x02, 0x02, 0x02, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_5[] =
{
	// @140 '5' (14 pixels wide)
	//               
	//               
	//               
	//     #####     
	//     #         
	//     #         
	//     #         
	//     ####      
	//     #   #     
	//         #     
	//         #     
	//     #   #     
	//      ###      
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0xF8, 0x88, 0x88, 0x88, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x09, 0x10, 0x10, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_6[] =
{
	// @168 '6' (14 pixels wide)
	//               
	//               
	//               
	//      ###      
	//     #   #     
	//     #         
	//     #         
	//     # ##      
	//     ##  #     
	//     #   #     
	//     #   #     
	//     #   #     
	//      ###      
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0xF0, 0x08, 0x88, 0x88, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x0F, 0x11, 0x10, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_7[] =
{
	// @196 '7' (14 pixels wide)
	//               
	//               
	//               
	//     #####     
	//         #     
	//         #     
	//        #      
	//        #      
	//       #       
	//       #       
	//      #        
	//      #        
	//      #        
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x08, 0xC8, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_8[] =
{
	// @224 '8' (14 pixels wide)
	//               
	//               
	//               
	//      ###      
	//     #   #     
	//     #   #     
	//     #   #     
	//      ###      
	//     #   #     
	//     #   #     
	//     #   #     
	//     #   #     
	//      ###      
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x0F, 0x10, 0x10, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_9[] =
{
	// @252 '9' (14 pixels wide)
	//               
	//               
	//               
	//      ###      
	//     #   #     
	//     #   #     
	//     #   #     
	//     #  ##     
	//      ## #     
	//         #     
	//         #     
	//     #   #     
	//      ###      
	//               
	//               
	//               
	0x00, 0x00, 0x00, 0x00, 0xF0, 0x08, 0x08, 0x88, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x08, 0x11, 0x11, 0x10, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00
};

const uint8_t digit_colon[] =
{
//:
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
const uint8_t empty_digit[] = 
{
// Nothing, just to clear the existing digit
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
const uint8_t* digit2text_array[11] = {digit_0, digit_1, digit_2, digit_3, digit_4, digit_5, 
                                  digit_6, digit_7, digit_8, digit_9, digit_colon, empty_digit};
static int digit_array[6] = {1,5,0,2,2,8};

static int digit_array_carry[6] = {0, 0, 0, 0, 0, 0};
uint8_t* text_array[8];

int check_carry()
{
  for(int i = 5; i >= 0; i--) 
  {
    if(digit_array_carry[i]) 
      return i;
    else continue;
  }
  return 6;
}

bool check_end_day()
{
  if(digit_array[0]==2&&
     digit_array[1]==3&&
     digit_array[2]==5&&
     digit_array[3]==9&&
     digit_array[4]==5&&
     digit_array[5]==9) return true;
   return false;
}

void update_digit_array()
{
  int i;
  if(check_end_day()) memset(digit_array, 0, 6);
  else {
    digit_array_carry[5] = true;
    i = check_carry();
    while(i != 6)
    {
      digit_array[i]++;
      digit_array_carry[i] = false;
      if(digit_array[5]==10)
      {
        digit_array[5] = 0;
        digit_array_carry[4] = true;
      }
      else if(digit_array[4]==6)
      {
        digit_array[4]=0;
        digit_array_carry[3]=true;
      }
      else if(digit_array[3]==10)
      {
          digit_array[3]=0;
          digit_array_carry[2]=true;
      }
      else if(digit_array[2] == 6)
      {
        digit_array[2] = 0;
        digit_array_carry[1] = true;
      }
      else if(digit_array[1] == 10)
      {
        digit_array[1] = 0;
        digit_array_carry[0] = true;
      }
      i = check_carry();
    }
  }
}

void map_array()
{
  text_array[2] = digit2text_array[10];
  text_array[5] = digit2text_array[10];

  text_array[0] = digit2text_array[digit_array[0]];
  text_array[1] = digit2text_array[digit_array[1]];
  text_array[3] = digit2text_array[digit_array[2]];
  text_array[4] = digit2text_array[digit_array[3]];
  text_array[6] = digit2text_array[digit_array[4]];
  text_array[7] = digit2text_array[digit_array[5]];
}

// Character descriptors for Microsoft Sans Serif 10pt
// { [Char width in bits], [Offset into microsoftSansSerif_10ptCharBitmaps in bytes] }
const FONT_CHAR_INFO microsoftSansSerif_10ptDescriptors[] = 
{
	{14, 0}, 		// 0 
	{14, 28}, 		// 1 
	{14, 56}, 		// 2 
	{0, 0}, 		// 3 
	{0, 0}, 		// 4 
	{14, 84}, 		// 5 
	{0, 0}, 		// 6 
	{14, 112}, 		// 7 
	{0, 0}, 		// 8 
	{0, 0}, 		// 9 
	{14, 140}, 		// : 
};

// Font information for Microsoft Sans Serif 10pt
const FONT_INFO microsoftSansSerif_10ptFontInfo =
{
	2, //  Character height
	'0', //  Start character
	':', //  End character
	2, //  Width, in pixels, of space character
	microsoftSansSerif_10ptDescriptors, //  Character descriptor array
	microsoftSansSerif_10ptBitmaps, //  Character bitmap array
};

